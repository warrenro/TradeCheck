# TradeCheck 交易審計系統規格書

---

## 1. 專案概述 (Project Overview)
**TradeCheck** 是一個專為短線交易者設計的交易紀錄分析與風險控管工具。它能讀取用户的交易歷史（支援 `.csv` 或 `.xlsx` 格式），並根據預設的風控規則進行審計，最終生成一份綜合報告，幫助使用者評估其交易表現並識別潛在風險。

---

## 2. 核心功能 (Core Features)

### 2.1 交易紀錄分析 (Transaction Analysis)
- **支援格式**: 可讀取並解析 `.csv` 及 `.xlsx` 格式的交易紀錄檔案。
- **資料提取**: 自動從交易紀錄中提取關鍵資訊，包括 `成交時間`、`買賣別` 及 `平倉損益淨額`。
- **指標計算**:
  - **勝率 (Win Rate)**: 計算 `(獲利交易筆數 / 總交易筆數) * 100%`。
  - **賺賠比 (Profit/Loss Ratio)**: 計算 `平均每筆獲利金額 / 平均每筆虧損金額`。
  - **月損益 (Monthly PnL)**: 計算指定月份內所有交易的總損益。

### 2.2 風險審計 (Risk Audit)
系統會根據以下規則進行自動審計：
1.  **最大連續虧損筆數 (Max Consecutive Losses)**:
    - **規則**: 連續虧損不得超過 **5** 筆。
    - **觸發**: 當偵測到連續虧損達到或超過此上限時，系統會發出警示。
2.  **單日最大虧損金額 (Max Daily Loss)**:
    - **規則**: 當日總虧損不得超過 `目前權益數 * 2%`。
    - **觸發**: 當日累積虧損超過此上限時，系統會發出警示。

### 2.3 帳戶升級評估 (Account Upgrade Assessment)
系統會根據以下條件，評估使用者是否具備晉升至下一級操作規模的資格：
- **評估週期**: 每月進行一次。
- **評估標準**:
  1. **連續三個月皆為正損益**: 最近三個月的 `月損益` 均 > 0。
  2. **風險事件未觸發**: 在此三個月期間，從未觸發 `最大連續虧損` 或 `單日最大虧損` 警示。
- **結果**:
  - **成功**: 帳戶可`升級`至新的操作規模。
  - **失敗**: 維持目前規模，並提供未達標原因。

---

## 3. 指令碼模式 (Script Mode)

### 3.1 執行方式
使用者可透過執行 `trade_check.py` 指令碼來啟動分析。

- **指令**: `python trade_check.py`
- **配置文件**: 腳本會讀取 `config.ini` 以獲取 `目前權益數`、`月初本金` 及 `操作規模` 等參數。
- **交易資料**: 腳本會自動讀取 `tradedata/` 目錄下的交易紀錄檔案。

### 3.2 輸出結果
執行完成後，會在根目錄生成一份 `audit_report.json`，包含完整的分析指標與審計結果。

---

## 4. 伺服器模式 (Server Mode)

### 4.1 啟動方式
執行 `server.py` 可啟動一個本地 Web 伺服器。

- **指令**: `python server.py`
- **功能**:
  - 提供 API 端點 `/upload`，允許使用者上傳交易紀錄檔案。
  - 接收檔案後，即時進行分析與審計。
  - 回傳與指令碼模式結構相同的 JSON 報告。

---

## 5. 設定檔 (`config.ini`)
本系統透過 `config.ini` 進行參數配置，其結構如下：

```ini
[settings]
equity = 100000
initial_capital = 100000
scale = 500000
```

- **equity**: 目前權益數
- **initial_capital**: 月初本金
- **scale**: 目前操作規模

---

## 6. 視覺化前端介面 (Visualization Frontend)
為提升使用者體驗，本系統額外建置了網頁前端介面，將後端產出的 JSON 審計報告進行視覺化呈現。

### 6.1 介面概述 (UI Overview)
前端介面採用儀表板 (Dashboard) 風格設計，主要分為兩大區塊：
1.  **左側輸入區**:
    -   **系統參數表單**: 讓使用者以圖形化方式輸入`目前權益數`、`月初本金`及`操作規模`。
    -   **檔案上傳**: 提供按鈕讓使用者上傳交易紀錄檔案（支援 `.csv`, `.xlsx`）。
2.  **右側報告區**:
    -   **KPI 卡片**: 以醒目的卡片格式即時呈現`勝率`、`賺賠比`及`月損益`等關鍵指標。
    -   **狀態面板**: 透過清晰的區塊及顏色標示（綠色代表安全/通過，紅色代表警示/違規），顯示`帳戶狀態`、`風險檢查結果`與`升級評估`。

### 6.2 多國語系支援 (Internationalization)
- **語言切換**: 介面右上角提供下拉式選單，支援即時切換**繁體中文 (zh-TW)**與**英文 (en)** 兩種語言。
- **翻譯範圍**: 介面上所有靜態標題、標籤與狀態文字皆会根據所選語言變更。由後端動態產生的文字訊息（如升級失敗原因）則會維持其原始語言。

---

## 7. 資料格式要求 (Data Format Requirements)

### 7.1 交易紀錄檔案 (Transaction Record File)
為了讓指令碼模式能順利執行，交易紀錄檔案（支援 `.csv` 或 `.xlsx`）需放置在 `tradedata/` 目錄下，且必須包含以下三個欄位：

1.  **成交時間**: 交易發生的完整時間，格式需為 `YYYY/MM/DD HH:MM:SS`。
2.  **買賣別**: 交易的類型。
3.  **平倉損益淨額**: 該筆交易的淨損益，需為數值格式（可包含千分位符號，如 `20,060`）。

**注意**: 腳本會自動將這些中文欄位名稱映射到內部處理所用的英文名稱 (`trade_time`, `action`, `net_pnl`)。
# 版本歷史 (Version History)

## Version 2.1 (2025-12-08)

### ✨ 新功能 (Features)
- **K線資料匯入流程優化**:
  - **使用者自選檔案**: 將原有的「自動掃描匯入」改為「使用者手動選擇」。前端現在會彈出一個檔案選擇器，列出 `KData/` 目錄下的所有 CSV 檔案，讓使用者可以精確選擇要匯入的行情資料。
  - **新增後端 API**: 建立了 `GET /api/kdata_files` 端點來提供檔案列表，並修改了 `POST /api/import_kdata` 來接收指定檔名。
- **前端使用者體驗優化**:
  - **負值紅色突顯**: 在網頁介面上，所有負數的財務指標（如單筆或總和損益）均以紅色字體顯示，讓虧損狀況一目了然。

### ♻️ 重構 (Refactoring)
- **後端腳本模組化**: `import_kdata.py` 腳本被重構為接收檔案路徑參數，使其功能更單一化，易於被 API 調用。

### 📚 文件 (Documentation)
- **全面更新技術與使用者文件**:
  - `spec.md`: 更新了 K 線匯入功能的規格，以及新增了負值突顯的前端呈現說明。
  - `README.md`: 更新了網頁介面的操作說明，以符合新的 K 線匯入流程，並在近期更新中加入了新功能說明。
  - `process.md`: 詳細記錄了新的 K 線匯入功能的架構設計與前後端互動流程。
  - `Version.md`: 更新版本歷史，準確反映 `v2.1` 的所有變更。

## Version 1.9 (2025-12-06)

### ✨ 新功能 (Features)
- **年度總結分年計算**: 「年度總結」區塊現在會針對每個交易年份獨立計算並顯示其總體交易表現（總損益、整體勝率、賺賠比和總交易筆數），取代了之前單一總結所有年份數據的方式，提供更細緻的年度分析視角。

## Version 1.8 (2025-12-06)

### ✨ 新功能 (Features)
- **前端年度總結區塊**: 在網頁介面中「月度總結」下方新增「年度總結」區塊，顯示審計期間的總體交易表現，包括總損益、整體勝率、賺賠比和總交易筆數。

## Version 1.7 (2025-12-06)

### ✨ 新功能 (Features)
- **前端顯示月初本金**: 在網頁介面的「帳戶狀態」區塊，新增顯示 `config.ini` 中設定的 `monthly_start_capital` (月初本金)，提供更完整的帳戶起始資訊。

## Version 1.6 (2025-12-06)

### ✨ 新功能 (Features)
- **帳戶權益數動態計算**: 帳戶的「目前權益數」現在會基於 `config.ini` 中的 `monthly_start_capital` 加上當月的損益 (Monthly PnL) 動態計算。這取代了原先直接從 `config.ini` 讀取 `current_capital` 的方式，使評估更為即時和準確。

## Version 1.5 (2025-12-06)

### ✨ 新功能 (Features)
- **升級資格原因細節**: 在評估與激勵區塊，當帳戶不符合升級資格時，系統現在會列出詳細的計算細節，例如「權益數未達標 (Capital not met): 1,000,000 / 200,000」，讓使用者能清楚了解未達標的具體項目。

## Version 1.4 (2025-12-06)

### 🐞 錯誤修正 (Bug Fixes)
- **修復後端序列化問題**: 解決了當 Pandas/Numpy 的數值型別 (如 `int64`) 無法被標準 `json` 函式庫序列化，導致後端在產生 `audit_report.json` 或 API 回應時崩潰的問題。已加入一個客製化的 JSON 編碼器來正確處理這些數值型別。

## Version 1.3 (2025-12-04)

### ✨ 新功能 (Features)
- **後端狀態顯示**: 前端介面新增後端伺服器狀態指示燈，即時顯示連線狀態。
- **互動式月報表**: 使用者現在可以點擊月統計報表中的任一月份，以彈出式視窗查看該月份的詳細交易明細。

---

## Version 1.2 (2025-12-04)

### ✨ 新功能 (Features)
- **新增 Log 紀錄功能**: 系統現在會將詳細的執行紀錄與錯誤資訊輸出至 `trade_audit.log` 檔案與主控台，方便追蹤與除錯。
- **前端日誌紀錄**: 前端應用程式現在會將關鍵操作事件與錯誤回傳至後端，並統一記錄在 `trade_audit.log` 中。

---

## Version 1.1 (2025-12-04)

### ✨ 新功能 (Features)
- **動態讀取交易資料**: 指令碼 (`trade_check.py`) 現在會自動從 `tradedata/` 資料夾中尋找並分析最新的交易紀錄檔案，無需手動修改程式碼。
- **支援新資料格式**:
    - 能夠自動對應中文欄位名稱 (`成交時間`, `買賣別`, `平倉損益淨額`)。
    - 支援處理帶有千分位逗號的損益金額。

### ♻️ 重構 (Refactoring)
- **移除範例資料**: 刪除了原有的 `dummy_trades.csv`，改為完全依賴 `tradedata/` 中的實際資料。
- **簡化資料處理**: 根據使用者確認，移除了原先用來過濾平倉交易的邏輯，現在所有讀入的資料都會被視為已完成的交易進行分析。

### 📚 文件 (Documentation)
- **更新 `README.md`**:
    - 更新了「指令碼模式」的使用說明，以反映新的檔案讀取機制。
    - 在「檔案結構」中新增了 `tradedata/` 資料夾的說明。
- **更新 `spec.md`**: 新增了「資料格式要求」章節，明確定義了交易紀錄檔案所需的欄位與格式。
- **新增 `Version.md`**: 加入此版本歷史檔案，以記錄未來的開發歷程。

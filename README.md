# TradeCheck 交易審計系統

本專案是一個專為短線交易者設計的交易紀錄分析與風險控管工具。它能讀取使用者的交易歷史，並根據預設的風控規則進行審計，最終生成一份綜合報告，幫助使用者評估其交易表現並識別潛在風險。

此專案包含兩種操作模式：
1.  **指令碼模式 (Command-Line)**: 直接執行 Python 腳本進行分析。
2.  **網頁介面模式 (Web UI)**: 透過內建的 Python 伺服器與簡易前端介面進行互動操作。

---

## 核心功能 (Features)

- **升級標準總覽**: 儀表板會自動顯示所有級別的官方升級標準，讓使用者清楚了解目標。
- **視覺化儀表板**: 提供一個網頁介面，將審計報告以視覺化方式呈現，包含關鍵指標與風險狀態。
- **後端狀態監控**: 前端介面能即時顯示後端伺服器的運行狀態。
- **互動式報表**: 使用者可點擊月度報表，深入查看該月份的詳細交易紀錄。
- **自動化審計**:
  - **KPI 計算**: 自動計算勝率、賺賠比、月損益等關鍵指標。
  - **風險規則檢查**:
    - **最大連續虧損筆數**: 監控連續虧損是否超過 5 筆。
    - **單日最大虧損金額**: 監控當日總虧損是否超過目前權益的 2%。
- **帳戶升級評估**:
  - 每月自動評估使用者是否滿足連續三個月正損益且無觸發風險事件的條件，以判斷是否具備升級資格。
- **日誌記錄 (Logging)**:
  - 將後端、前端的所有操作與錯誤統一記錄至 `trade_audit.log` 檔案中，方便追蹤與除錯。

---

## 技術棧 (Tech Stack)

- **後端 (Backend)**: Python, Pandas
- **前端 (Frontend)**: HTML, JavaScript (vanilla)
- **核心邏輯 (Core Logic)**: Python

---

## 安裝與啟動 (Installation & Usage)

### 先決條件 (Prerequisites)
請確保您的系統已安裝：
- [Python](https://www.python.org/downloads/) (3.8 或更高版本)
- [Node.js](https://nodejs.org/) (用於前端開發，如果需要修改前端程式碼)

### 模式一：網頁介面 (Web UI)

1.  **安裝 Python 依賴套件:**
    ```bash
    pip install --upgrade -r requirements.txt
    ```

2.  **啟動後端伺服器:**
    ```bash
    python server.py
    ```
    後端服務將會運行在 `http://localhost:8000`。

3.  **開啟瀏覽器**並訪問 `http://localhost:8000`，即可開始使用。前端頁面由後端直接提供。


### 模式二：指令碼 (Command-Line)

如果您只想使用原始的 Python 指令碼進行分析：

1.  **準備您的交易資料**:
    -   將您的交易紀錄檔案（支援 `.csv` 或 `.xlsx` 格式）放入專案根目錄下的 `tradedata/` 資料夾中。
    -   請確保檔案包含 `成交時間`, `買賣別`, `平倉損益淨額` 這幾個欄位。

2.  **安裝 Python 依賴套件:**
    ```bash
    pip install --upgrade -r requirements.txt
    ```

3.  **執行 Python 指令碼:**
    ```bash
    python trade_check.py
    ```
    指令碼會自動在 `tradedata/` 資料夾中尋找最新的一筆交易紀錄檔案進行分析，並將結果輸出到終端機。

---

## 偵錯與日誌 (Debugging & Logging)
為了方便開發者追蹤與除錯，本系統已整合了完整的日誌 (Log) 紀錄功能。

-   **日誌檔案**: 所有執行期間的詳細資訊與錯誤（包含前端操作、後端與指令碼模式）都會被記錄在專案根目錄下的 `trade_audit.log` 檔案中。
-   **主控台輸出**: 日誌也會即時顯示在您執行後端伺服器或指令碼的終端機視窗中。

當您遇到問題時，請優先查閱此日誌檔案以獲得詳細的錯誤軌跡。

---

## 檔案結構 (Project Structure)

```
TradeCheck/
├── frontend/              # 前端應用程式 (HTML, JS)
│   ├── src/
│   └── index.html         # HTML 主頁
├── tradedata/             # 存放交易紀錄檔案的資料夾
├── trade_check.py         # 核心審計邏輯 (指令碼模式)
├── server.py              # 後端伺服器 (網頁模式)
├── requirements.txt       # Python 依賴套件
├── spec.md                # 系統規格書
└── README.md              # 本說明文件
```
---

## 附錄：帳戶升級資格計算方法

本系統會根據以下規則，評估帳戶是否符合升級資格。所有規則皆定義於 `trade_check.py`。

### 1. 升級標準 (Upgrade Criteria)

系統內建一個 `UPGRADE_CRITERIA` 字典，明確定義了從目前交易規模 (Scale) 晉升至下一級別所需的客觀條件。

**各級別升級標準如下：**

| 目前級別 | 目標級別 | 資本額要求 (Capital Key) | 風報比要求 (RR Key) | 勝率要求 (WR Key) |
|:--------:|:--------:|:--------------------------:|:-------------------:|:-----------------:|
|    S1    |    S2    |        `>= 200,000`        |      `>= 1.5`       |      `>= 25%`     |
|    S2    |    S3    |        `>= 400,000`        |      `>= 2.0`       |      `>= 30%`     |
|    S3    |    S4    |        `>= 600,000`        |      `>= 2.0`       |      `>= 33%`     |
|    S4    |    S5    |        `>= 800,000`        |      `>= 2.5`       |      `>= 35%`     |

### 2. 關鍵績效指標 (KPI) 計算方式

系統會透過 `_calculate_kpis` 函式，基於您的交易紀錄來計算以下兩個核心指標：

-   **勝率 (Win Rate, WR)**
    -   **定義**: 獲利交易的筆數在所有交易總筆數中所佔的比例。
    -   **計算公式**:
        ```
        勝率 = (獲利交易總筆數 / 總交易筆數)
        ```

-   **風報比 (Risk/Reward Ratio, RR)**
    -   **定義**: 平均每筆獲利金額與平均每筆虧損金額之間的比率，用以衡量冒險的效益。
    -   **計算公式**:
        ```
        風報比 = 平均獲利金額 / ABS(平均虧損金額)
        ```
        *註：`ABS` 代表取絕對值。*

### 3. 資格綜合評估

在 `_evaluate_capital_management` 函式中，系統會將您目前的 **資本額** 與計算出的 **KPI 指標** 與 `UPGRADE_CRITERIA` 中的標準進行比對。

一筆帳戶必須 **同時滿足** 以下兩個條件，才能獲得升級資格：

1.  **資本額達標 (Capital OK)**:
    -   `您目前的資本額 >= 該級別的資本額要求`

2.  **交易表現達標 (Performance OK)**:
    -   `您的風報比 >= 該級別的風報比要求`
    -   **且** `您的勝率 >= 該級別的勝率要求`

如果其中任何一項不滿足，系統將判定為不符合升級資格，並在報告中明確指出未達標的項目。